<div class="edit-form">
  <h2 appBigtitle>Editar Estudiante</h2>

  <!-- Formulario para buscar estudiante -->
  <form [formGroup]="searchForm" (ngSubmit)="onSearch()" class="form">
    <mat-form-field appearance="fill">
      <mat-label>Seleccionar Estudiante</mat-label>
      <mat-select formControlName="dni">
        <mat-option *ngFor="let student of students$ | async" [value]="student.dni">
          {{ student.name }} {{ student.surname }} (DNI: {{ student.dni }})
        </mat-option>
      </mat-select>
      <mat-error *ngIf="searchForm.get('dni')?.hasError('required')">
        Debe seleccionar un estudiante
      </mat-error>
    </mat-form-field>

    <div class="button-container">
      <button mat-raised-button color="primary" type="submit" [disabled]="searchForm.invalid">
        Buscar
      </button>
      <button mat-raised-button color="warn" type="button" (click)="onReset()">
        Limpiar
      </button>
      <a mat-stroked-button [routerLink]="['/', routes.Alumnos]">
        Volver a la lista
      </a>
    </div>
  </form>

  <hr *ngIf="selectedStudent$ | async" />

  <!-- Formulario para editar el estudiante encontrado -->
  <form *ngIf="selectedStudent$ | async" [formGroup]="editForm" (ngSubmit)="onEdit()" class="form">
    <mat-form-field appearance="fill">
      <mat-label>Nombre</mat-label>
      <input matInput formControlName="name" placeholder="Nombre del estudiante">
      <mat-error *ngIf="editForm.get('name')?.invalid">
        {{editForm.get('name')?.hasError('required') ? 'El nombre es obligatorio' :
        editForm.get('name')?.hasError('minlength') ? 'Mínimo 3 caracteres' :
        'Máximo 50 caracteres'}}
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Apellido</mat-label>
      <input matInput formControlName="surname" placeholder="Apellido del estudiante">
      <mat-error *ngIf="editForm.get('surname')?.invalid">
        {{editForm.get('surname')?.hasError('required') ? 'El apellido es obligatorio' :
        editForm.get('surname')?.hasError('minlength') ? 'Mínimo 3 caracteres' :
        'Máximo 50 caracteres'}}
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Edad</mat-label>
      <input matInput type="number" formControlName="age" min="1">
      <mat-error *ngIf="editForm.get('age')?.invalid">
        {{editForm.get('age')?.hasError('required') ? 'La edad es obligatoria' :
        'La edad debe ser mayor a 0'}}
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Promedio</mat-label>
      <input matInput type="number" formControlName="average" min="1" max="10" step="0.01">
      <mat-error *ngIf="editForm.get('average')?.invalid">
        {{editForm.get('average')?.hasError('required') ? 'El promedio es obligatorio' :
        editForm.get('average')?.hasError('min') ? 'El promedio mínimo es 1' :
        editForm.get('average')?.hasError('max') ? 'El promedio máximo es 10' :
        'Solo se permiten hasta 2 decimales'}}
      </mat-error>
    </mat-form-field>

    <div class="button-container">
      <button mat-raised-button color="primary" type="submit" [disabled]="editForm.invalid || (loading$ | async)">
        {{(loading$ | async) ? 'Guardando...' : 'Guardar Cambios'}}
      </button>
      <button mat-raised-button color="warn" type="button" (click)="onReset()">
        Cancelar
      </button>
    </div>
  </form>
</div>